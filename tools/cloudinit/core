#cloud-config
users:
  - name: radix
    sudo: ALL=(ALL) NOPASSWD:ALL
    groups: users, admin, docker
    ssh_import_id: None
    lock_passwd: true
    shell: /bin/bash
    ssh_authorized_keys:
      - ssh-rsa qJKwDkz9CVV0HqRTFBIpHa3b7hC1Ko3a71F+r2pYjN8H6niNjPx4e15HdyKKbuK5ZMJCVO1C99D165j55W9Yb7dJlUHRGX1lG+MixKhOPP3d/f13FlXpcwFfGk1SYsP3Fi6lW26wpdYdEQvxhFXKeycs9GthMxeaoHy3D/iGeXJ+c4RlTbBaM7q5PykP7Hx7pma4rqqvygxC5WqVsDR7vh9vJHid0R3AeympzqMGUd7op6q8gRhJ6xAkDe73PHrUPqvTzPoburAu9qAohXcA98JiTmu93lqVz/EMyneoCSHzrQoMw0IrSk65YtTtOGZHUTVN/Q5UJrLTxBNUFZWIdQ== tpstester
      - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDGY8hcEfiX3WX4V+PJBf6QT+dKUE6cjjTCUqbW23wbd5HYXDLRYqYbAWfOeaIdjkzCIliaCRXRaZ/o6frvPMPvAyt37TYDtCVhWnjpvFEk8DVPNl43oMqPnhMPNtx6aBU9u0x1ByPWtXIXFCshB3HM+eieP8y50QiCGRxGg1RwfCra5A13+Uy29ALi01IBq+wPmG+TIHHsOBdJ3dDe2SBIyW43kfOkOSUmoGsKCaI2cNBuoJrD7SoRgXOsU8nAz3ssaPs1plvF6xFeHr2s0yoLPWHf+7eR2nHh+A3BfR6kdM2VnTea9hPBaLZos9GyU3HgDXZTTovl2asmX0to0WNw9mmXz0LyqOts+AIDG2r84BR5V5Mzj5IS+15UzHwJCMcjciG+48bJmPPUMNrPkaU+bH7k497kSg4BZR8bievSMLNcMcYEu8LLmX8NX7dQOyEyZ9OXl7fVr8gm6l97zNdrK7gwZj37Yc0lzumh4VM7a7GS+ngyWRReRn3TUP7HllNtMr+q68uSA+wZWOpeUJ4fZ9/1Ny6EiQc3rG0pGOKZAdglCT1yBIaDEv7KeJUmbo+ovjlcek9X8VJikZvqvEs3mkryewB2SSeYNVdoY2MKfB50I8zq4PZ3jMwN3lN7XSGQQGhkwAxW18HOEcfyWrEmHzvsek5F6WbqjLNgZrqiPQ== james
      - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQCn4IoPa6vmhuk2GVCKy66lUSwl8AprjfjKn6iZ/jRW5TxrRsv/3tKlTt5MAjjviSKCXVKiRC1kqNXfOYl1PiCyVt3pwMfl6uCDJG4f6SK8a4N1Wa1fX4l2jRfrqXOSy1aUyNlxcdO03Yx6EtTcuxPbFDvzWBkmWO+y5Mc+TtxGAV6iH90jBxdMEGc/cfVWi7DR1Er+ptw4lKKxnO00t7iF2kSoReLYbBd4u6HAD3/LUSKYM/aW4GnCsvrd3X6nIpeu4B+OPHGSGVf+V3IHI3HbqHwX+BuCqvDay9zfDn+Nxt2vGCih4AbmKJdpq8fYnzxN30zLHShX6YBT3KRs53CwYu4qXGHxgcdLn2zXeRLm+QhroyIbp62GBzzYUQmQkT6GKl88gG8e8SljMJvFDY03Y/6ppomhsgt9xGJcaiQEgrCA9OkdnDzxYMqlPd+P8prhJUgp7Mkh+b35RGGxA1WCLPvn6/YZfxbHNkCeZQB54vpCTP//b18eHgFwOAWILacbTLERgJTnTRBqeFDMDnmcC/jj0P1hTL/hg5hgTOmiLQ1tZGPPfhshrP3skfafuIaUqVo8Wj6W0j8Z3my8Vojl+yuUQNyPSGEMuu6TTt21TUA9WXVReA8pcUeQIPrKmnKwrRv8XmISnemAPjCPWwQYT9CYyBw8mi2py0xLaym3YQ== zalan
      - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDAqVNuhBCRtLlSPnpfXRcz+ouGShumSbsmk2u7HEUDPaEkpvdjmiKlRtUImbFm63kFSpeOex7dOCncqux4jwZh6eIYxFefDy7Bs5Vga+iXBDaXvugPAxhYB3x9k4fP1kGHDSOkvi8UkXQEM+AFeVfPRJMmmkvmVqK3nlF7jr3DLv58icGHGbWQf+JexYyrOU+EJ8ejNUGhf54sEQ8b9jyG9rlio8+yApt36tSI/xNYwjCVUbTmyufIYU0riilKvmUzaqlZ1ynJrExqBgyPhUUuOhgXdSyP6D8eZ+xHPMzmUYQEazqCxEqslgnv/yfaT7mIV3/4vPAvDXnJyj0y+JTJAEZDKnrb2BuLfQ5KUJy83musmxVN+kG4btUFdaUGpRNvkPql+3B2oqaknySI6nKBGXggWN0flhDqcqj1y1jboIcSHUEQVeacXh3roJaCiM7o6uhkHsbFDUQEZAuqWZXrC3xcMSeT2vxV1Eh15XR7l75BURjpeoJ1ZZ3d1mOi0yOkDkqKp/aDu00uWqm5pybCBuyAb2rongpnpMCw6ms3ehYRffnP3B7anBuhzeY8AzzqPLhC2oG0Ama6Mf0hk7hR94J9P8bYYAcXFofylVIbyar7D3lybXhu5SLh5Vc52RbKaLCKbIvuQBJvogIE8E/1Kox0CFQOA6rBKEefs3uWtw== edgars
      - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQC8ahvq09KQCXAUsbHk8AUUHU2nQ/wXaskeAYYii5umz6mxE/csu/K6uRbV3pgQW8o8QGfKXPpCngG7FL1v99U+z17xdih2pmuOET1P0Xnp+jZFggpuF5+BxEds64tl9iyMN0LPaiXvDbW4vEl7IFoS0YRr8/OH9/AQE3khCG8MfFk1X+hWLeuaWBVOSKeiKnQlqxSPKQEWAfaA9shncjHR11xTSpW5i5l9Au6qZf/1rVmjVDDd38AywMlTOeOGuM528bUJK09YuulKMRhETlGJlStg7LResGYvoGPi5wpChGwPnInPWIJLWFNZQhVt4zF7Mbf8+EmMNNv9BkvYJoLElyZgsE+yQC+VQJXF2NukVOcmlmVhakOHQqAUx2SjOaky/Xb0ULoigpwige1TQ1ddvQ0Zmq8QAEPJFkxW4wdYjjJkmQbMJU+Cuw/ga5GjN+gNpC1zqYhpZwqQHxHTVYEhE7gSrXC7b/OjAo02jXlJEdjNL9Q6KEaceFzBNEXEAUmcZ3HnqCZs5QusRwDgQINAL1mXKFZ3JXp2FszmtUSoJsoNwJyqmqrXVCh1/NzAstdn9GtggB8owOyEEK2wt8mzMGkmXdB1sEQYagnz/B2/rKEmsrNOxHcSKTLlpW8jEEkfMwHuV+NYgC48w5iZFIOPtRSjZ6hlqG9+N3Vb8dWIIQ== florian
      - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDHGFdD+JlVeHOdupJiiC299Bwidk9Gj52K0AVL2l1TRXFT7aXg6Kt+ZJ1Z7Iv9q01hRGA6u8fAI4vvF9LKG0tzH7yc8TCcyRXOXeWmEtDSoaDWn6DMWsJcfVAd5o1Leov8P7dzVdsAM+twuotu/6DSU6DsDhUEqCdk9wJExP4nrtHa5UxIPMdBQjLIJqqXqNuV2GjcB2jBhrrJjRpwjHEhFPozLd1w3AlOhP0rkKajYKflFm2z3XoYuWjfkd8D/wft1Ssde5Y6gBl66wyfQQg5yHou5AIFiIHPLd2z4haDLSN2IE4Em99Bv7nKdBWbU6OWtxkSV8QyHe3pAgz1Z4RhDWag+Hxd4QQBT79vBi7sLxYH+ioYIaIZhhrGvGYIgVAOzSdBkMDB0NoFWNXuND/esjFXXZdz8osaULCGsYiIxwBD7VdaUHaDHHCpzRKXsZ4M4+RMFbc6sz0TWgT5XeuBzxXDtXhiI3c8zxKUzSLJ/S6QxdH2W4VkYMgO6f3qOA7uGgCC1mj6VF0WzAdwcs+W8uLe0NsPM9SWFyKJAjOf7YxKK4llbYKUlHsiFm6bXBfzXZBcwKMqbGiGVze3LtLLhikGRWPzzmXWWlwMzL/JcC1NzPUSy4rIZ4QBpffFuSoQdFOn/TST9bHj2YD3WXF7b2gBtwdV2Vpg92tqUZz3xQ== martin
      - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQC9UfVzfrExjkIT4A0z+KAmzkRWuz1UXUvTddGANMqr3+DEPX6brPJ7ISkZVmSFzd+PIBD5S7wZX1lrEs2cD2TmUOWW8+FFgDFfcL9vjF/+Nyo63pqHfvyQcBvV3MHN/LNxMTxwnW3stAV4puWHt8rqcGT8eDQMgOIHkx+SlIsAiXh34O5jbse4MbepxK+W5lBHbRKo1tVdi6pSsSb84ljVN5Eo3hMhT8LjyXuFffCIv5gyfivvPZwSNgmMuCzrRA3cIYZw0dyQWs2kc4ByLRipn/tYYoSQUtnXcCtEf8d1NiayPL86rF/9HPyC2nEQh4KIUqv+5y/4a78zyyTEPNJramzUmyRALCdvPkSQ6DLg9Syce0jGyVZWNHQN0RkCtLvWUPqNmBVg647OWkuD/hGSZOZ6ru70fjHIbo97eZlueDjHZ7bTQVTtqXtplrSkIBgcATLMZw/13xI6TUWTZwrzXLdN2uWcqkoDXgGSqzWPVOIDFkj4PjQLWmXfmSHSkGuHMP8hqqeW9lSo/mmKpSv83Cv7OXxAYuPXeqT+uT57jvCKDGCBh833BpBqBJRHLRMuUdLkcQ2hXKOH0KiqGiKf51L9Er4bZk6d43nI4xhOKNQjAKXjquSRejd3/m9vs3V9dg469O+ZbISVRVZZN9VUT+Z1jc9fsTYJse05+fJUdw== greg
      - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQCm5guRETzrqwskDI4TiLGg9HYgaTP0/3yQz0wOHz++mEVAa/VgkTi3PRNAN95691KYsJO2Z5ld6gy/qYx5Ka189vTRoB0gyOLnKeCaIoQRuOO7j01fy4wv+AboALKx3xEclZdU6PJxKdiKqu9/mQlPu1htvVMI8rqHpfOM69FZsQq07cSpF6lYwcMnUIvW/RSKdAAO/Gl3z4vKsyDikN9HOYYjGCh0Ed7TQXS76qPGfdY/yYn6hgKzB+xz06K47GJpRpyJHNhfTGAGlIW2vgTFcaO5JwpqLEVB+7r7rmZZoOfWiLUpDPCuU5IjX7etbFdrsNZdfV7glZls6fx0Jl4G1+lO3gvA29Xh6UVu6Mx9X8N/zn0VRk1I0nO/6hSEuigq8WBksCSraCEBojyMMRzBW3RT0GDXvSeUvYC5HTmI5AGDIRJ7aPVDUTmqL0W6JHPKiJKHSUDNTaa0u5Hu0ghC/1irvgUMyOsYSDFuLtmPYX4raXgjZ2XJyMBaq3HeZSAiPnGlTKdIeP6dc6sXB3Tvv2ZKt5eOQP+bo8EdKJGWlCv1jzgPgN1nZ4vyDGnBd/R2RtwhrnntKTgLeZSwiW2uQruopoELRCaTWk/J4mcIFX38MhzyrkszseR9g67BVEp8o46ghGNAx7zDNiTn6ErSPQusCDPXq48pCOT46ArK3Q== salvatore
write_files:
  - path: /etc/radixdlt/docker-compose.yml
    content: | 
        version: '2.2'
        services:
            core:
                image: radixdlt/radixdlt-core:atom-pump-amd64
                init: true
                restart: unless-stopped
                ports:
                    - "127.0.0.1:9009:9009"
                    - "127.0.0.1:9010:9010"
                    - "20000:20000/tcp"
                    - "20000:20000/udp"
                environment:
                    CORE_GOSSIP_PORT: 20000
                    CORE_NETWORK_DISCOVERY_URLS: ""
                    CORE_NETWORK_SEEDS: "$RADIX_MTPS_NETWORK_SEEDS"
                    CORE_EXPLORER_IP: "$RADIX_MTPS_NETWORK_EXPLORER_IP"
                    CORE_PUMP_ATOMS_URL: "$RADIX_MTPS_NETWORK_ATOMS_FILE"
                    CORE_SECURE_RANDOM_SOURCE: /dev/urandom
                    CORE_UNIVERSE: "$RADIX_MTPS_NETWORK_UNIVERSE"
                    TIMETORUNTEST: "$RADIX_MTPS_NETWORK_START_PUMP" # e.g. "17.00" or "now+5min"
                    JAVA_OPTS: "-server -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=9009 -XX:+HeapDumpOnOutOfMemoryError -Dcom.sun.management.jmxremote.port=9010 -Dcom.sun.management.jmxremote.rmi.port=9010 -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false -Djava.rmi.server.hostname=localhost"
                volumes:
                    - "core_ledger:/opt/radixdlt/RADIXDB"
                    - "core_config:/opt/radixdlt/etc"
                    - "/radix:/radix"
                cap_add:
                    - NET_ADMIN
                # network_mode: host
                logging:
                    options:
                        max-size: "100m"
                        max-file: "10"                
            nginx:
                image: radixdlt/radixdlt-nginx:alphanet2
                restart: unless-stopped
                ports:
                    - "443:443"
                environment:
                    METRICS_PASSWORD: "$RADIX_MTPS_NETWORK_PASSWORD"
                    ADMIN_PASSWORD: "$RADIX_MTPS_NETWORK_PASSWORD"
                    WIPE_ADMIN_PASSWORD: "no"
                    WIPE_METRICS_PASSWORD: "no"
                volumes:
                    - "nginx_secrets:/etc/nginx/secrets"
            prometheus:
              # TODO: change to image SHA256 for main net launch
              image: radixdlt/radixdlt-prometheus:latest
              restart: unless-stopped
              ports:
                - "9090:9090"
              volumes:
                - "prometheus_tsdb:/prometheus"
              logging:
                options:
                  max-size: "1m"
                  max-file: "30"
            exporter:
              # TODO: change to image SHA256 for main net launch
              image: radixdlt/radixdlt-exporter:latest
              restart: unless-stopped
              volumes:
                - "/sys:/sys:ro"
              environment:
                RADIXDLT_CORE_BASE_URL: http://core:8080
                RADIXDLT_NGINX_BASE_URL: https://nginx
                RADIXDLT_CORE_RTP_METRICS: "yes"
              logging:
                options:
                  max-size: "1m"
                  max-file: "10"
        volumes:
            core_ledger:
            core_config:
            nginx_secrets:
            prometheus_tsdb:
mounts:
  - [ sdb, /radix ]
runcmd:
  - set -ex
  - sudo docker-compose -f /etc/radixdlt/docker-compose.yml up -d